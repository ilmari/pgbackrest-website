<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>pgBackRest Configuration Reference: archive</title><meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="pgBackRest - Reliable PostgreSQL Backup &amp; Restore" property="og:site_name">
<meta content="pgBackRest Configuration Reference: archive" property="og:title">
<meta content="website" property="og:type">
<link href="favicon.png" rel="icon" type="image/png">
<meta content="image/png" property="og:image:type">
<meta content="http://www.pgbackrest.org/logo.png" property="og:image">
<meta content="The pgBackRest Configuration Reference details all configuration options." name="description">
<meta content="The pgBackRest Configuration Reference details all configuration options." property="og:description">
<link href="default.css" rel="stylesheet" type="text/css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VKCRNV73H1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-VKCRNV73H1');</script>
</head><body><div class="section1"><a id="section-archive"></a><div class="section1-header"><div class="section1-number">
2
</div><div class="section1-title">
Archive Options (<span class="id">archive</span>)
</div></div><div class="section-intro">
The <span class="br-setting">archive</span> section defines options for the <span class="cmd">archive-push</span> and <span class="cmd">archive-get</span> commands.
</div><div class="section-body"><div class="section2"><a id="section-archive/option-archive-async"></a><div class="section2-header"><div class="section2-number">
2.1
</div><div class="section2-title">
Asynchronous Archiving Option (<span class="id">--archive-async</span>)
</div></div><div class="section-body"><div class="section-body-text">
Push/get WAL segments asynchronously.
</div><div class="section-body-text">
Enables asynchronous operation for the <span class="cmd">archive-push</span> and <span class="cmd">archive-get</span> commands.<br>
<br>
Asynchronous operation is more efficient because it can reuse connections and take advantage of parallelism. See the <span class="br-option">spool-path</span>, <span class="br-option">archive-get-queue-max</span>, and <span class="br-option">archive-push-queue-max</span> options for more information.
</div>
<pre class="code-block">default: n
example: archive-async=y</pre>
</div></div><div class="section2"><a id="section-archive/option-archive-get-queue-max"></a><div class="section2-header"><div class="section2-number">
2.2
</div><div class="section2-title">
Maximum Archive Get Queue Size Option (<span class="id">--archive-get-queue-max</span>)
</div></div><div class="section-body"><div class="section-body-text">
Maximum size of the <span class="backrest">pgBackRest</span> archive-get queue.
</div><div class="section-body-text">
Specifies the maximum size of the <span class="cmd">archive-get</span> queue when <span class="br-option">archive-async</span> is enabled. The queue is stored in the <span class="br-option">spool-path</span> and is used to speed providing WAL to <span class="postgres">PostgreSQL</span>.
</div>
<pre class="code-block">default: 128MiB
allowed: 0-4PiB
example: archive-get-queue-max=1GiB</pre>
</div></div><div class="section2"><a id="section-archive/option-archive-header-check"></a><div class="section2-header"><div class="section2-number">
2.3
</div><div class="section2-title">
Check WAL Headers Option (<span class="id">--archive-header-check</span>)
</div></div><div class="section-body"><div class="section-body-text">
Check PostgreSQL version/id in WAL headers.
</div><div class="section-body-text">
Enabled by default, this option checks the WAL header against the <span class="postgres">PostgreSQL</span> version and system identifier to ensure that the WAL is being copied to the correct stanza. This is in addition to checking <span class="file">pg_control</span> against the stanza and verifying that WAL is being copied from the same <span class="postgres">PostgreSQL</span> data directory where <span class="file">pg_control</span> is located.<br>
<br>
Therefore, disabling this check is fairly safe but should only be done when needed, e.g. if the WAL is encrypted.
</div>
<pre class="code-block">default: y
example: archive-header-check=n</pre>
</div></div><div class="section2"><a id="section-archive/option-archive-missing-retry"></a><div class="section2-header"><div class="section2-number">
2.4
</div><div class="section2-title">
Retry Missing WAL Segment Option (<span class="id">--archive-missing-retry</span>)
</div></div><div class="section-body"><div class="section-body-text">
Retry missing WAL segment
</div><div class="section-body-text">
Retry a WAL segment that was previously reported as missing by the <span class="cmd">archive-get</span> command when in asynchronous mode. This prevents notifications in the spool path from a prior restore from being used and possibly causing a recovery failure if consistency has not been reached.<br>
<br>
Disabling this option allows <span class="postgres">PostgreSQL</span> to more reliably recognize when the end of the WAL in the archive has been reached, which permits it to switch over to streaming from the primary. With retries enabled, a steady stream of WAL being archived will cause <span class="postgres">PostgreSQL</span> to continue getting WAL from the archive rather than switch to streaming.<br>
<br>
When disabling this option it is important to ensure that the spool path for the stanza is empty. The <span class="cmd">restore</span> command does this automatically if the spool path is configured at restore time. Otherwise, it is up to the user to ensure the spool path is empty.
</div>
<pre class="code-block">default: y
example: archive-missing-retry=n</pre>
</div></div><div class="section2"><a id="section-archive/option-archive-push-queue-max"></a><div class="section2-header"><div class="section2-number">
2.5
</div><div class="section2-title">
Maximum Archive Push Queue Size Option (<span class="id">--archive-push-queue-max</span>)
</div></div><div class="section-body"><div class="section-body-text">
Maximum size of the <span class="postgres">PostgreSQL</span> archive queue.
</div><div class="section-body-text">
After the limit is reached, the following will happen:<br>
<ul class="list-unordered"><li class="list-unordered"><span class="backrest">pgBackRest</span> will notify <span class="postgres">PostgreSQL</span> that the WAL was successfully archived, then <b>DROP IT</b>.</li><li class="list-unordered">A warning will be output to the <span class="postgres">PostgreSQL</span> log.</li></ul>If this occurs then the archive log stream will be interrupted and PITR will not be possible past that point. A new backup will be required to regain full restore capability.<br>
<br>
In asynchronous mode the entire queue will be dropped to prevent spurts of WAL getting through before the queue limit is exceeded again.<br>
<br>
The purpose of this feature is to prevent the log volume from filling up at which point <span class="postgres">PostgreSQL</span> will stop completely. Better to lose the backup than have <span class="postgres">PostgreSQL</span> go down.
</div>
<pre class="code-block">allowed: 0-4PiB
example: archive-push-queue-max=1TiB</pre>
<div class="section-body-text">
Deprecated Name: archive-queue-max
</div></div></div><div class="section2"><a id="section-archive/option-archive-timeout"></a><div class="section2-header"><div class="section2-number">
2.6
</div><div class="section2-title">
Archive Timeout Option (<span class="id">--archive-timeout</span>)
</div></div><div class="section-body"><div class="section-body-text">
Archive timeout.
</div><div class="section-body-text">
Set maximum time, in seconds, to wait for each WAL segment to reach the <span class="backrest">pgBackRest</span> archive repository. The timeout applies to the <span class="cmd">check</span> and <span class="cmd">backup</span> commands when waiting for WAL segments required for backup consistency to be archived.
</div>
<pre class="code-block">default: 60
allowed: 0.1-86400
example: archive-timeout=30</pre>
</div></div></div></div><div class="page-footer">
Copyright Â© 2015-2023, The PostgreSQL Global Development Group, <a href="https://github.com/pgbackrest/pgbackrest/blob/main/LICENSE">MIT License</a>. Updated July 24, 2023
</div></body></html>